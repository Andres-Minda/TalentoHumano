---
alwaysApply: true
---
# Reglas Inteligentes para Implementaci√≥n de Funciones

## CONFIGURACI√ìN DE BASE DE DATOS

### Informaci√≥n de Conexi√≥n
- **Sistema**: MariaDB (phpMyAdmin - XAMPP)
- **Host**: localhost
- **Puerto**: 3306
- **Usuario**: root  
- **Password**: `` (VAC√çO - sin contrase√±a)
- **Base de datos**: bienestar_estudiantil_db
- **Charset**: utf8mb4

### Rutas de Acceso
- **MySQL CLI**: `C:\xampp\mysql\bin\mysql.exe`
- **MySQLDump**: `C:\xampp\mysql\bin\mysqldump.exe`
- **phpMyAdmin**: http://localhost/phpmyadmin

## PROTOCOLO DE IMPLEMENTACI√ìN DE FUNCIONES

### PASO 1: AN√ÅLISIS AUTOM√ÅTICO DE BASE DE DATOS
**ANTES de implementar cualquier nueva funci√≥n, SIEMPRE:**

1. **Revisar estado actual de la BD:**
```bash
# Ver todas las tablas existentes
php db_manager.php show-tables

# Analizar estructura de tablas relevantes
php db_manager.php describe --table "nombre_tabla"
```

2. **Identificar qu√© necesita la nueva funci√≥n:**
   - ¬øQu√© datos necesita almacenar/recuperar?
   - ¬øQu√© tablas necesita consultar?
   - ¬øNecesita nuevas tablas, columnas o relaciones?
   - ¬øRequiere √≠ndices para optimizaci√≥n?

3. **Analizar impacto en datos existentes:**
   - ¬øLos cambios afectan datos actuales?
   - ¬øSe necesita migraci√≥n de datos?
   - ¬øHay que mantener compatibilidad?

### PASO 2: PLANIFICACI√ìN DE CAMBIOS
**Si se necesitan cambios en BD, crear plan estructurado:**

```markdown
## An√°lisis para funci√≥n: [NOMBRE_FUNCI√ìN]

### Tablas actuales relevantes:
- tabla1: [descripci√≥n de campos relevantes]
- tabla2: [descripci√≥n de campos relevantes]

### Cambios necesarios:
1. **Nuevas tablas:**
   - tabla_nueva: [campos y tipos]
   
2. **Modificaciones a tablas existentes:**
   - tabla_existente: agregar columna_nueva (tipo)
   
3. **Nuevas relaciones:**
   - FK entre tabla1.id y tabla2.tabla1_id

### Plan de ejecuci√≥n:
1. Backup autom√°tico
2. Crear/modificar estructura
3. Insertar datos iniciales (si es necesario)
4. Verificar integridad
```

### PASO 3: IMPLEMENTACI√ìN CON BACKUP AUTOM√ÅTICO

**Siempre crear backup antes de cambios importantes:**
```bash
# Backup autom√°tico antes de cambios
php db_manager.php backup
```

**Ejecutar cambios de BD ANTES del c√≥digo PHP:**
```bash
# Ejemplo de cambios t√≠picos
php db_manager.php execute --sql "CREATE TABLE nueva_tabla (id INT PRIMARY KEY AUTO_INCREMENT, nombre VARCHAR(100))"
php db_manager.php add-column --table "usuarios" --column "nueva_columna" --type "VARCHAR(50)"
```

### PASO 4: VERIFICACI√ìN POST-CAMBIOS
```bash
# Verificar que los cambios se aplicaron correctamente
php db_manager.php show-tables
php db_manager.php describe --table "tabla_modificada"
```

## COMANDOS ESPEC√çFICOS PARA AN√ÅLISIS

### Comandos de Diagn√≥stico R√°pido
```bash
# Ver estructura completa de una tabla
C:\xampp\mysql\bin\mysql.exe -u root bienestar_estudiantil_db -e "DESCRIBE tabla_name;"

# Ver relaciones/foreign keys
C:\xampp\mysql\bin\mysql.exe -u root bienestar_estudiantil_db -e "SELECT TABLE_NAME, COLUMN_NAME, CONSTRAINT_NAME, REFERENCED_TABLE_NAME, REFERENCED_COLUMN_NAME FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_SCHEMA = 'bienestar_estudiantil_db';"

# Ver √≠ndices de una tabla
C:\xampp\mysql\bin\mysql.exe -u root bienestar_estudiantil_db -e "SHOW INDEX FROM tabla_name;"

# Contar registros en tablas
C:\xampp\mysql\bin\mysql.exe -u root bienestar_estudiantil_db -e "SELECT COUNT(*) as total FROM tabla_name;"
```

### Script de An√°lisis Completo
```php
<?php
// db_analyzer.php - Usar antes de implementar funciones
class DatabaseAnalyzer extends DatabaseManager
{
    public function analyzeForFunction($functionName, $requirements)
    {
        echo "=== AN√ÅLISIS PARA FUNCI√ìN: $functionName ===\n\n";
        
        // 1. Estado actual
        echo "TABLAS EXISTENTES:\n";
        $tables = $this->getAllTables();
        foreach ($tables as $table) {
            echo "- $table\n";
            $structure = $this->getTableStructure($table);
            foreach ($structure as $field) {
                echo "  * {$field['Field']} ({$field['Type']})\n";
            }
            echo "\n";
        }
        
        // 2. An√°lisis de requerimientos
        echo "REQUERIMIENTOS DE LA FUNCI√ìN:\n";
        foreach ($requirements as $req) {
            echo "- $req\n";
        }
        
        // 3. Recomendaciones
        echo "\nRECOMENDACIONES:\n";
        $this->generateRecommendations($requirements, $tables);
    }
    
    private function generateRecommendations($requirements, $existingTables)
    {
        // L√≥gica para recomendar cambios basada en requerimientos
        echo "- Revisar si las tablas existentes cubren los requerimientos\n";
        echo "- Identificar nuevas tablas necesarias\n";
        echo "- Planificar relaciones entre tablas\n";
    }
    
    public function checkDataIntegrity()
    {
        echo "=== VERIFICACI√ìN DE INTEGRIDAD ===\n";
        
        $tables = $this->getAllTables();
        foreach ($tables as $table) {
            $count = $this->connection->query("SELECT COUNT(*) as total FROM `$table`")->fetch_assoc();
            echo "$table: {$count['total']} registros\n";
        }
    }
}
?>
```

## FLUJO DE TRABAJO OBLIGATORIO

### Para CADA nueva funci√≥n solicitada:

```markdown
1. **EJECUTAR AN√ÅLISIS:**
   ```bash
   php db_manager.php show-tables
   # Revisar tablas existentes relevantes para la funci√≥n
   ```

2. **EVALUAR NECESIDADES:**
   - ¬øLa funci√≥n requiere nuevos datos?
   - ¬øNecesita modificar estructura existente?
   - ¬øHay que crear relaciones nuevas?

3. **SI SE NECESITAN CAMBIOS:**
   ```bash
   # Backup autom√°tico
   php db_manager.php backup
   
   # Ejecutar cambios necesarios
   php db_manager.php execute --sql "SQL_COMMANDS_HERE"
   ```

4. **VERIFICAR CAMBIOS:**
   ```bash
   php db_manager.php describe --table "tabla_afectada"
   ```

5. **IMPLEMENTAR C√ìDIGO PHP/CodeIgniter:**
   - Crear/modificar controladores
   - Actualizar modelos con nuevos campos/relaciones
   - Crear/actualizar vistas

6. **DOCUMENTAR CAMBIOS:**
   ```bash
   # Actualizar documentaci√≥n de BD
   php database_info.php
   ```
```

## REGLAS ESPEC√çFICAS DE CODEIGNITER

### Modelos - Siempre actualizar despu√©s de cambios de BD:
```php
// Agregar nuevos campos a $fillable si existen
protected $fillable = ['campo1', 'campo2', 'nuevo_campo'];

// Actualizar relaciones si se agregaron FKs
public function relacion_nueva() {
    return $this->belongsTo('Modelo_relacionado');
}
```

### Controladores - Validar nuevos campos:
```php
$this->form_validation->set_rules('nuevo_campo', 'Nuevo Campo', 'required');
```

## CASOS ESPECIALES

### Funciones que NO requieren cambios de BD:
- Reportes con datos existentes
- Cambios de UI/UX solamente  
- Nuevas validaciones en frontend
- Modificaciones de l√≥gica de negocio sin nuevos datos

### Funciones que S√ç requieren cambios de BD:
- Nuevos m√≥dulos/funcionalidades
- Campos adicionales en formularios
- Nuevos tipos de usuarios/roles
- Sistemas de notificaciones
- Logs/auditor√≠a
- Configuraciones de sistema

## MENSAJE DE CONFIRMACI√ìN

**SIEMPRE incluir en la respuesta:**
```
‚úÖ AN√ÅLISIS DE BD COMPLETADO
üìä Estado actual revisado
üîß Cambios necesarios: [LISTAR]
üíæ Backup creado: [nombre_archivo]
‚ö° Cambios aplicados exitosamente
üìù C√≥digo implementado y probado
```

## RECORDATORIOS CR√çTICOS
```php
// En db_manager.php - cambiar l√≠nea:
private $database = 'bienestar_estudiantil_db';
```

### Comandos corregidos con el nombre real de la BD:
```bash
# Mostrar todas las tablas de bienestar_estudiantil_db
C:\xampp\mysql\bin\mysql.exe -u root bienestar_estudiantil_db -e "SHOW TABLES;"

# Backup de la base de datos espec√≠fica
C:\xampp\mysql\bin\mysqldump.exe -u root bienestar_estudiantil_db > backup_bienestar_estudiantil.sql

# Conectar directamente a la BD
C:\xampp\mysql\bin\mysql.exe -u root bienestar_estudiantil_db
```

- ‚úÖ **Password de BD**: VAC√çO (sin contrase√±a)
- ‚úÖ **Siempre analizar BD antes de implementar**
- ‚úÖ **Backup autom√°tico antes de cambios**
- ‚úÖ **Verificar integridad post-cambios**  
- ‚úÖ **Documentar todos los cambios realizados**
- ‚úÖ **Usar comandos espec√≠ficos de MariaDB/MySQL**